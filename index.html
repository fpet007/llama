<html><head><base href="https://deepinfra.com/"></base>
<style>
:root {
  --bg-color: #f0f0f0;
  --text-color: #333;
  --chat-bg: white;
  --user-msg-bg: #e6f2ff;
  --ai-msg-bg: #f0f0f0;
  --input-bg: #f9f9f9;
  --button-bg: #0066cc;
  --button-color: white;
  --button-hover: #0052a3;
  --header-bg: #0066cc;
  --header-color: white;
  --code-bg: #f4f4f4;
}

.dark-theme {
  --bg-color: #1a1a1a;
  --text-color: #e0e0e0;
  --chat-bg: #2a2a2a;
  --user-msg-bg: #3a3a3a;
  --ai-msg-bg: #303030;
  --input-bg: #3a3a3a;
  --button-bg: #0077e6;
  --button-color: #ffffff;
  --button-hover: #0066cc;
  --header-bg: #0077e6;
  --header-color: #ffffff;
  --code-bg: #2c2c2c;
}

body {
  font-family: Arial, sans-serif;
  line-height: 1.6;
  color: var(--text-color);
  max-width: 800px;
  margin: 0 auto;
  padding: 20px;
  background-color: var(--bg-color);
  transition: all 0.3s ease;
}

.chat-container {
  background-color: var(--chat-bg);
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
  overflow: hidden;
}

.chat-header {
  background-color: var(--header-bg);
  color: var(--header-color);
  padding: 15px;
  text-align: center;
  font-size: 1.2em;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.chat-messages {
  height: 500px;
  overflow-y: auto;
  padding: 20px;
}

.message {
  margin-bottom: 8px; /* Réduit de 15px */
  padding: 8px; /* Réduit de 10px */
  border-radius: 5px;
  max-width: 80%;
}

.user-message {
  background-color: var(--user-msg-bg);
  margin-left: auto;
}

.ai-message {
  background-color: var(--ai-msg-bg);
  white-space: pre-wrap;
  line-height: 1.2; /* Légèrement réduit de 1.5 */
}

.chat-input {
  display: flex;
  padding: 15px;
  background-color: var(--input-bg);
}

#user-input {
  flex-grow: 1;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 5px;
  font-size: 16px;
  background-color: var(--input-bg);
  color: var(--text-color);
}

#send-button {
  background-color: var(--button-bg);
  color: var(--button-color);
  border: none;
  padding: 10px 20px;
  margin-left: 10px;
  border-radius: 5px;
  cursor: pointer;
  font-size: 16px;
}

#send-button:hover {
  background-color: var(--button-hover);
}

.typing-indicator {
  display: none;
  font-style: italic;
  color: #888;
  margin-top: 10px;
}

#theme-toggle {
  background: none;
  border: none;
  color: var(--header-color);
  cursor: pointer;
  font-size: 1.2em;
}

/* Nouvelles règles pour réduire l'espace Markdown */
.ai-message h1, .ai-message h2, .ai-message h3, .ai-message h4, .ai-message h5, .ai-message h6 {
  margin-top: 0em; /* Réduit de 1em */
  margin-bottom: 0em; /* Réduit de 0.5em */
  font-weight: bold;
}

.ai-message h1 { font-size: 1.4em; } /* Réduit de 1.5em */
.ai-message h2 { font-size: 1.2em; } /* Réduit de 1.3em */
.ai-message h3 { font-size: 1.1em; }

.ai-message strong {
  font-weight: bold;
}

.ai-message em {
  font-style: italic;
}

.ai-message ul, .ai-message ol {
  padding-left: 20px;
  margin-bottom: 8px; /* Réduit de 10px */
}

.ai-message li {
  margin-bottom: 4px; /* Réduit de 5px */
}

.ai-message code {
  font-family: monospace;
  background-color: var(--code-bg);
  padding: 2px 4px;
  border-radius: 3px;
}

.ai-message pre {
  background-color: var(--code-bg);
  padding: 8px; /* Réduit de 10px */
  border-radius: 5px;
  overflow-x: auto;
  margin-bottom: 8px; /* Ajouté pour réduire l'espace après les blocs de code */
}

.ai-message pre code {
  background-color: transparent;
  padding: 0;
}

.ai-message blockquote {
  border-left: 3px solid var(--button-bg);
  padding-left: 10px;
  margin-left: 0;
  color: #777;
  margin-bottom: 8px; /* Ajouté pour réduire l'espace après les citations */
}

/* Réduction supplémentaire de l'espace */
.ai-message p {
  margin-bottom: 2px; /* Réduction de l'espace entre les paragraphes */
}

.ai-message > *:last-child {
  margin-bottom: 0; /* Supprime la marge inférieure pour le dernier élément du message IA */
}
</style>
</head>
<body>
  <div class="chat-container">
    <div class="chat-header">
      <span>Meta-Llama-3.1-405B Chat (Streaming)</span>
      <button id="theme-toggle">🌓</button>
    </div>
    <div class="chat-messages" id="chat-messages">
      <!-- Messages seront insérés ici -->
    </div>
    <div class="typing-indicator" id="typing-indicator">L'IA est en train d'écrire...</div>
    <div class="chat-input">
      <input type="text" id="user-input" placeholder="Tapez votre message ici...">
      <button id="send-button">Envoyer</button>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/2.0.3/marked.min.js"></script>
  <script>
    const chatMessages = document.getElementById('chat-messages');
    const userInput = document.getElementById('user-input');
    const sendButton = document.getElementById('send-button');
    const typingIndicator = document.getElementById('typing-indicator');
    const themeToggle = document.getElementById('theme-toggle');

    const API_URL = 'https://api.deepinfra.com/v1/openai/chat/completions';
    const API_KEY = 'sI1UE9Tf1NQ10VP5nVOvCze98ks5PjVY';

    let conversationHistory = [];

    function addMessage(content, isUser = false) {
      const messageDiv = document.createElement('div');
      messageDiv.classList.add('message');
      messageDiv.classList.add(isUser ? 'user-message' : 'ai-message');
      messageDiv.innerHTML = isUser ? content : marked(content);
      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    async function sendMessage() {
      const userMessage = userInput.value.trim();
      if (userMessage === '') return;

      addMessage(userMessage, true);
      userInput.value = '';

      conversationHistory.push({ role: "user", content: userMessage });

      typingIndicator.style.display = 'block';

      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${API_KEY}`
          },
          body: JSON.stringify({
            model: "meta-llama/Meta-Llama-3.1-405B-Instruct",
            stream: true,
            messages: [
              { role: "system", content: "Vous êtes un assistant IA capable de structurer vos réponses avec des paragraphes concis, des listes à puces si nécessaire, et des retours à la ligne appropriés pour une meilleure lisibilité. Utilisez le format Markdown pour structurer vos réponses, y compris les titres, le texte en gras, les listes, et le formatage de code pour HTML et Python. Veillez à formater vos réponses de manière agréable à lire et bien détaillée, tout en maintenant une structure compacte." },
              ...conversationHistory
            ]
          })
        });

        const reader = response.body.getReader();
        const decoder = new TextDecoder();
        let aiResponse = '';
        let aiMessageDiv = document.createElement('div');
        aiMessageDiv.classList.add('message', 'ai-message');
        chatMessages.appendChild(aiMessageDiv);

        while (true) {
          const { value, done } = await reader.read();
          if (done) break;
          
          const chunk = decoder.decode(value);
          const lines = chunk.split('\n');
          
          for (const line of lines) {
            if (line.startsWith('data:')) {
              try {
                const data = JSON.parse(line.slice(5));
                if (data.choices && data.choices[0].delta && data.choices[0].delta.content) {
                  const content = data.choices[0].delta.content;
                  aiResponse += content;
                  aiMessageDiv.innerHTML = marked(aiResponse);
                  chatMessages.scrollTop = chatMessages.scrollHeight;
                }
              } catch (e) {
                console.error('Error parsing JSON:', e);
              }
            }
          }
        }

        conversationHistory.push({ role: "assistant", content: aiResponse });
        typingIndicator.style.display = 'none';
      } catch (error) {
        console.error('Error:', error);
        addMessage('Désolé, une erreur s\'est produite lors du traitement de votre demande. Veuillez réessayer.');
        typingIndicator.style.display = 'none';
      }
    }

    sendButton.addEventListener('click', sendMessage);
    userInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') sendMessage();
    });

    // Fonctionnalité pour changer le thème
    themeToggle.addEventListener('click', () => {
      document.body.classList.toggle('dark-theme');
      themeToggle.textContent = document.body.classList.contains('dark-theme') ? '☀️' : '🌓';
    });

    // Message d'accueil initial
    addMessage(`# Bonjour ! Je m'appelle Meta-Llama-3.1-405B.
Comment puis-je vous aider aujourd'hui ?

Je suis ravi de pouvoir discuter avec vous et répondre à vos questions de manière claire et structurée. N'hésitez pas à me poser des questions sur n'importe quel sujet, je ferai de mon mieux pour vous fournir des réponses bien organisées et faciles à lire.

N'hésitez pas à me poser des questions sur n'importe quel sujet, je suis là pour vous aider !`);
  </script>
</body>
</html>
